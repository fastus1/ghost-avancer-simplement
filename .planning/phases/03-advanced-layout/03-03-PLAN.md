---
phase: 03-advanced-layout
plan: 03
type: execute
wave: 2
depends_on: [03-01, 03-02]
files_modified:
  - content/themes/avancer-simplement/default.hbs
  - content/themes/avancer-simplement/assets/css/screen.css
autonomous: false

must_haves:
  truths:
    - "Page uses CSS Grid layout with header spanning full width"
    - "Sidebar stays visible while scrolling (position sticky)"
    - "Main content fills remaining space after sidebar"
    - "On mobile (<768px), sidebar is hidden and hamburger menu appears"
    - "Transition between Circle.so and blog feels seamless"
  artifacts:
    - path: "content/themes/avancer-simplement/default.hbs"
      provides: "Restructured layout with header, sidebar, main areas"
      contains: "circle-header"
    - path: "content/themes/avancer-simplement/assets/css/screen.css"
      provides: "CSS Grid layout with responsive breakpoints"
      contains: ".site-layout"
  key_links:
    - from: "default.hbs"
      to: "partials/circle-header.hbs"
      via: "partial include"
      pattern: "\\{\\{> \"circle-header\""
    - from: "default.hbs"
      to: "partials/circle-sidebar.hbs"
      via: "partial include"
      pattern: "\\{\\{> \"circle-sidebar\""
    - from: "default.hbs"
      to: "partials/mobile-menu.hbs"
      via: "partial include"
      pattern: "\\{\\{> \"mobile-menu\""
---

<objective>
Integrate header, sidebar, and mobile menu into CSS Grid layout

Purpose: Complete the Circle.so layout transformation with responsive behavior
Output: Fully functional layout matching Circle.so design, ready for visual verification
</objective>

<execution_context>
@/root/.claude/get-shit-done/workflows/execute-plan.md
@/root/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-advanced-layout/03-CONTEXT.md
@.planning/phases/03-advanced-layout/03-RESEARCH.md
@/root/yan/projets/Ghost Avancer Simplement/design-ghost.md

# Prior plan summaries (dependencies)
@.planning/phases/03-advanced-layout/03-01-SUMMARY.md
@.planning/phases/03-advanced-layout/03-02-SUMMARY.md

# Current files to modify
@content/themes/avancer-simplement/default.hbs
@content/themes/avancer-simplement/assets/css/screen.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add CSS Grid layout styles</name>
  <files>content/themes/avancer-simplement/assets/css/screen.css</files>
  <action>
Add section "17. Circle Layout Grid" after section 16 (Mobile Menu):

Main layout container:
```css
.site-layout {
    display: grid;
    grid-template-columns: 281px 1fr;
    grid-template-rows: 64px 1fr;
    grid-template-areas:
        "header header"
        "sidebar main";
    min-height: 100vh;
}
```

Header positioning:
```css
.circle-header {
    grid-area: header;
}
```

Sidebar positioning (CRITICAL: align-self: start for sticky to work):
```css
.circle-sidebar {
    grid-area: sidebar;
    position: sticky;
    top: 64px;
    height: calc(100vh - 64px);
    overflow-y: auto;
    align-self: start;
}
```

Main content area:
```css
.site-main {
    grid-area: main;
    min-height: calc(100vh - 64px);
    padding: 0 max(4vmin, 20px);
}
```

Responsive breakpoint (mobile < 768px):
```css
@media (max-width: 768px) {
    .site-layout {
        grid-template-columns: 1fr;
        grid-template-rows: 64px 1fr;
        grid-template-areas:
            "header"
            "main";
    }

    .circle-sidebar {
        display: none;
    }

    .circle-header__burger {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        width: 24px;
        height: 18px;
        cursor: pointer;
    }

    .circle-header__nav {
        display: none;
    }
}
```

Also update the .viewport styles to no longer use flex (grid takes over):
- Remove or override .viewport flex-direction
- The .site-layout wrapper becomes the main structural element
  </action>
  <verify>
- grep ".site-layout {" assets/css/screen.css
- grep "grid-template-areas" assets/css/screen.css
- grep "@media (max-width: 768px)" assets/css/screen.css
  </verify>
  <done>CSS Grid layout with responsive mobile breakpoint</done>
</task>

<task type="auto">
  <name>Task 2: Restructure default.hbs with new layout</name>
  <files>content/themes/avancer-simplement/default.hbs</files>
  <action>
Restructure default.hbs body content:

1. Move mobile menu checkbox and partial BEFORE .site-layout wrapper (required for CSS sibling selector):
   - {{> "mobile-menu"}} right after opening body tag

2. Create new wrapper structure:
```handlebars
<div class="site-layout">
    {{!-- Circle.so Header --}}
    {{> "circle-header"}}

    {{!-- Sidebar with articles --}}
    {{> "circle-sidebar"}}

    {{!-- Main content area --}}
    <main class="site-main">
        {{{body}}}
    </main>
</div>
```

3. Remove old header (#gh-head) entirely - it's replaced by circle-header

4. Keep the footer OUTSIDE .site-layout (or remove if Circle.so doesn't have one - check context)

5. Remove theme-toggle from gh-head-actions (it's now in sidebar)

6. Add mobile-menu.js script before ghost_foot:
   <script src="{{asset "js/mobile-menu.js"}}"></script>

7. Keep existing scripts (jQuery, casper.js, theme-toggle.js)

Important structural notes:
- Mobile menu checkbox must be sibling to .site-layout for CSS checkbox hack to work
- FOWT prevention script stays in head
- Lightbox conditional stays after .site-layout
  </action>
  <verify>
- grep 'circle-header' default.hbs
- grep 'circle-sidebar' default.hbs
- grep 'site-layout' default.hbs
- grep 'mobile-menu' default.hbs
  </verify>
  <done>default.hbs restructured with CSS Grid layout and all new partials</done>
</task>

<task type="auto">
  <name>Task 3: Build theme and validate</name>
  <files>content/themes/avancer-simplement/assets/built/screen.css</files>
  <action>
Final build and validation:

1. cd content/themes/avancer-simplement
2. npm run zip (compile CSS)
3. npx gscan . --v5 (validate theme)

Verify no errors. Warnings are acceptable.

If build fails, fix issues before checkpoint.
  </action>
  <verify>
- npm run zip completes successfully
- gscan shows no errors
- ls assets/built/screen.css confirms CSS compiled
  </verify>
  <done>Theme builds and validates successfully</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Circle.so layout: 64px header with navigation, 281px sidebar with articles, CSS Grid responsive layout, hamburger mobile menu
  </what-built>
  <how-to-verify>
1. Ensure Ghost is running: visit http://localhost:2368
2. Verify header:
   - Height is 64px
   - Logo displays (Cloudinary image)
   - All 7 navigation links visible
   - "Blog" has active pill style (background highlight)
   - External links open in new tab
3. Verify sidebar:
   - 281px width
   - Shows "Articles" section with post list
   - Theme toggle at bottom works (dark/light switch)
4. Verify main content:
   - Content displays correctly
   - No overlap with header or sidebar
5. Verify responsive (resize browser to < 768px):
   - Sidebar disappears
   - Hamburger icon appears in header
   - Clicking hamburger opens mobile menu
   - Pressing Escape closes menu
6. Verify dark/light mode:
   - Toggle changes all colors (header, sidebar, content)
   - Colors match design spec (#2B2E33 dark, #FFFFFF light)
7. Compare with Circle.so:
   - Open https://communaute.avancersimplement.com in new tab
   - Visually compare header styling
   - Transition should feel seamless
  </how-to-verify>
  <resume-signal>Type "approved" if layout matches Circle.so, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
1. default.hbs includes circle-header, circle-sidebar, mobile-menu partials
2. CSS Grid layout creates header/sidebar/main areas
3. Sidebar uses position: sticky with align-self: start
4. Mobile breakpoint hides sidebar and shows hamburger
5. All colors use CSS variables for theme support
6. Theme builds and passes gscan validation
7. Human verification confirms visual match with Circle.so
</verification>

<success_criteria>
- Layout visually matches Circle.so design spec
- Header 64px with navigation and active Blog pill
- Sidebar 281px sticky with article list and theme toggle
- Responsive mobile layout with working hamburger menu
- Dark/light mode applies to all new elements
- User approves the visual result
</success_criteria>

<output>
After completion, create `.planning/phases/03-advanced-layout/03-03-SUMMARY.md`
</output>
